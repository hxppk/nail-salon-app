generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String
  phone     String?
  role      String   @default("CUSTOMER")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("users")
}

model Member {
  id               String          @id @default(cuid())
  name             String
  phone            String          @unique
  email            String?
  birthday         DateTime?
  gender           String?
  address          String?
  membershipLevel  String          @default("BRONZE")
  points           Int             @default(0)
  totalSpent       Float           @default(0)
  joinDate         DateTime        @default(now())
  lastVisit        DateTime?
  notes            String?
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt

  appointments Appointment[]
  transactions Transaction[]

  @@map("members")
}

model Staff {
  id          String   @id @default(cuid())
  name        String
  phone       String   @unique
  email       String?
  specialties String
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  appointments Appointment[]

  @@map("staff")
}

model Service {
  id          String   @id @default(cuid())
  name        String
  description String?
  price       Float
  duration    Int
  category    String
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  appointmentServices AppointmentService[]

  @@map("services")
}

model Appointment {
  id          String            @id @default(cuid())
  memberId    String
  staffId     String
  startTime   DateTime
  endTime     DateTime
  status      String            @default("SCHEDULED")
  notes       String?
  totalAmount Float             @default(0)
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt

  member   Member               @relation(fields: [memberId], references: [id], onDelete: Cascade)
  staff    Staff                @relation(fields: [staffId], references: [id])
  services AppointmentService[]
  transactions Transaction[]

  @@map("appointments")
}

model AppointmentService {
  id            String @id @default(cuid())
  appointmentId String
  serviceId     String

  appointment Appointment @relation(fields: [appointmentId], references: [id], onDelete: Cascade)
  service     Service     @relation(fields: [serviceId], references: [id])

  @@unique([appointmentId, serviceId])
  @@map("appointment_services")
}

model Transaction {
  id            String          @id @default(cuid())
  memberId      String
  appointmentId String?
  type          String
  amount        Float
  pointsEarned  Int             @default(0)
  pointsUsed    Int             @default(0)
  description   String
  createdAt     DateTime        @default(now())

  member      Member       @relation(fields: [memberId], references: [id], onDelete: Cascade)
  appointment Appointment? @relation(fields: [appointmentId], references: [id])

  @@map("transactions")
}

model Product {
  id          String   @id @default(cuid())
  name        String
  description String?
  price       Float
  stock       Int      @default(0)
  category    String
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("products")
}

// SQLite does not support enums, using String types instead
// Valid values for reference:
// UserRole: ADMIN, STAFF, CUSTOMER
// Gender: MALE, FEMALE, OTHER  
// MembershipLevel: BRONZE, SILVER, GOLD, PLATINUM
// AppointmentStatus: SCHEDULED, IN_PROGRESS, COMPLETED, CANCELLED
// TransactionType: SERVICE, PRODUCT, MEMBERSHIP, POINTS_REDEMPTION